<!-- ✅ Add a filter form -->

<h3>Filter Expenses</h3>
<form method="GET">
    Category:
    <select name="category">
        <option>All</option>
        <option>Food</option>
        <option>Transport</option>
        <option>Rent</option>
        <option>Utilities</option>
        <option>Other</option>
    </select>

    From:
    <input type="date" name="start_date">

    To:
    <input type="date" name="end_date">

    <input type="submit" value="Apply Filter">
</form>

<!-- ✅ Add a Pie Chart for category spending -->

<h3>Spending by Category</h3>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<canvas id="categoryChart" width="400" height="400"></canvas>

<!-- Safe JSON for Chart.js -->
<script id="category-data" type="application/json">
    {{ total_by_category_json|safe }}
</script>

<script>
    const data = JSON.parse(document.getElementById('category-data').textContent);
    const labels = data.map(item => item.category);
    const totals = data.map(item => item.total);

    const ctx = document.getElementById('categoryChart').getContext('2d');
    const categoryChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                label: 'Total Spent',
                data: totals,
                backgroundColor: [
                    '#FF6384',
                    '#36A2EB',
                    '#FFCE56',
                    '#4BC0C0',
                    '#9966FF',
                    '#FF9F40',
                ],
            }]
        }
    });
</script>

<h2>Your Expenses</h2>

<p><a href="{% url 'add_expense' %}">➕ Add New Expense</a></p>

<table border="1">
    <tr>
        <th>Date</th>
        <th>Category</th>
        <th>Amount (₹)</th>
        <th>Description</th>
        <th>Actions</th>
    </tr>
    {% for expense in expenses %}
    <tr>
        <td>{{ expense.date }}</td>
        <td>{{ expense.category }}</td>
        <td>{{ expense.amount }}</td>
        <td>{{ expense.description }}</td>
        <td>
            <a href="{% url 'edit_expense' expense.id %}">Edit</a> |
            <a href="{% url 'delete_expense' expense.id %}">Delete</a>
        </td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="5">No expenses found.</td>
    </tr>
    {% endfor %}
</table>